<p id="notice" ><%= notice %></p>

<h1>Empréstimos Ativos</h1>

<table class="table table-striped">
  <thead>
    <tr>
      <th>Usuário</th>
      <th>Sala</th>
      <th>Registro de Entrada</th>
      <th></th>
      <th colspan="2"></th>
    </tr>
  </thead>

  <tbody>
    <% @loans.ativos.each do |loan| %>
      <tr>
        <td><%= loan.user.nome %></td>
        <td><%= loan.room.title %></td>
        <td><%= loan.input_register.strftime("%H:%M:%S %d/%m/%Y") %></td>
        <td><%= if loan.output_register == nil
                  button_to "Registrar Devolução", {:controller => :loans, :action => 'devolver', :id => loan.id }, :method => :post, class: "btn btn-danger"
                else
                  loan.output_register.strftime("%H:%M:%S %d/%m/%Y")
                end %></td>
        <td><%= link_to 'Editar', edit_loan_path(loan), class: "btn btn-sm btn-default" %></td>
        <td><%= link_to 'Apagar', loan, method: :delete, data: { confirm: 'Are you sure?' }, class: "btn btn-sm btn-default" %></td>
      </tr>
    <% end %>
  </tbody>
</table>
  <br>
  <%= link_to 'Novo Empréstimo', new_loan_path, class: "btn btn-success" %>
  <br><br>
  <% if @user_logado and (@user_logado.admin or @user_logado.servidor) %>
  <%= link_to 'Permissões', authorizations_path, class: "btn btn-default" %>
  <%= link_to 'Usuários',  users_path, class: "btn btn-default"  %>
  <%= link_to 'Salas', rooms_path, class: "btn btn-default" %>
  <% end %>
  <br>
 <h2>Histórico de Empréstimos</h2>
 <table class="table table-striped">
   <thead>
     <tr>
       <th>Usuário</th>
       <th>Sala</th>
       <th>Registro de Entrada</th>
       <th>Registro de Saída</th>
     </tr>
   </thead>

   <tbody>
     <% @loans.inativos.last(35).reverse.each do |loan| %>
       <tr>
         <td><%= loan.user.nome %></td>
         <td><%= loan.room.title %></td>
         <td><%= loan.input_register.strftime("%H:%M:%S %d/%m/%Y") %></td>
         <td><%= loan.output_register.strftime("%H:%M:%S %d/%m/%Y") %></td>
       </tr>
     <% end %>
   </tbody>
 </table>

<br>
